<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Plan 11B – Season 25-26</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="main-header">
    <img src="images/CUP10.PNG" alt="Team Logo" class="logo" />
    <h1>Game Plan 11B – Season 25-26</h1>
  </header>
  <section id="calendar"></section>
  <script>
    Promise.all([
      fetch('game_meta.json').then(r => r.json()),
      fetch('games.json').then(r => r.json())
    ]).then(([meta, games]) => {
      // Build a lookup for extra game details
      const gameMap = {};
      games.forEach(g => gameMap[g.id] = g);

      // Helper: get the Saturday of the week for a given date string
      function getWeekendKey(dateStr) {
        // Parse date (assumes format like "Aug 14, 2025")
        const d = new Date(dateStr);
        if (isNaN(d)) return dateStr; // fallback if parsing fails
        const day = d.getDay();
        const saturday = new Date(d);
        saturday.setDate(d.getDate() - day + 6); // 6 = Saturday
        return saturday.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      }

      // Group games by weekend (Saturday)
      const weekends = {};
      meta.forEach(game => {
        const details = gameMap[game.id] || {};
        const date = game.date || details.date || '';
        if (!date) return;
        const weekendKey = getWeekendKey(date);
        if (!weekends[weekendKey]) weekends[weekendKey] = [];
        weekends[weekendKey].push({ ...game, ...details, date });
      });

      // Helper to color score
      function scoreClass(score) {
        if (!score) return '';
        const parts = score.split('-');
        if (parts.length !== 2) return '';
        const us = parseInt(parts[0], 10);
        const them = parseInt(parts[1], 10);
        if (isNaN(us) || isNaN(them)) return '';
        if (us > them) return 'score-win';
        if (us < them) return 'score-lose';
        return 'score-draw';
      }

      // Render
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = Object.entries(weekends).map(([weekend, games]) => `
        <h2 class="month-header">${weekend}</h2>
        <div class="game-grid">
          ${games.map(game => {
            const score = game.score || '';
            return `
              <div class="game-card">
                <div class="game-date">${game.date || ''}</div>
                <h2>${game.opponent ? 'vs ' + game.opponent : ''}</h2>
                <div>${game.competition || ''}</div>
                <div class="game-meta">
                  <span class="formation">${game.formation || ''}</span>
                  <span class="score ${scoreClass(score)}">${score}</span>
                </div>
                <a href="game.html?id=${game.id}" class="view-link">View Plan</a>
              </div>
            `;
          }).join('')}
        </div>
      `).join('');
    });
  </script>
</body>
</html>
