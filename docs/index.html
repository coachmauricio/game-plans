<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Plan 11B – Season 25-26</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <header class="main-header">
    <img src="images/CUP10.PNG" alt="Team Logo" class="logo" />
    <h1>Game Plan 11B – Season 25-26</h1>
  </header>
  <section id="calendar"></section>
  <script>
    Promise.all([
      fetch('game_meta.json').then(r => r.json()),
      fetch('games.json').then(r => r.json())
    ]).then(([meta, games]) => {
      // Helper to color score
      function scoreClass(score) {
        if (!score) return '';
        const parts = score.split('-');
        if (parts.length !== 2) return '';
        const us = parseInt(parts[0], 10);
        const them = parseInt(parts[1], 10);
        if (isNaN(us) || isNaN(them)) return '';
        if (us > them) return 'score-win';
        if (us < them) return 'score-lose';
        return 'score-draw';
      }

      // Build a lookup for extra game details
      const gameMap = {};
      games.forEach(g => gameMap[g.id] = g);

      // Sort all games by date
      const sortedGames = meta
        .map(g => ({ ...g, dateObj: new Date(g.date) }))
        .filter(g => !isNaN(g.dateObj))
        .sort((a, b) => a.dateObj - b.dateObj);

      // Render all games in order
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = sortedGames.map(game => {
        const details = { ...game, ...gameMap[game.id] };
        return `
          <div class="game-card" data-date="${details.date}">
            ${details.scorers && details.scorers.length ? `
              <div class="scorers-list">${details.scorers.join(', ')}</div>
            ` : ''}
            <div class="game-date">${details.date || ''}</div>
            <h2>${details.opponent ? 'vs ' + details.opponent : ''}</h2>
            ${details.formation ? `<div class="formation">${details.formation}</div>` : ''}
            <div>${details.competition || ''}</div>
            <div class="game-meta">
              <span class="score ${scoreClass(details.score || '')}">${details.score || ''}</span>
            </div>
            <a href="game.html?id=${details.id}" class="view-link">View Plan</a>
          </div>
        `;
      }).join('');

      // Highlight current week
      const today = new Date();
      const startOfWeek = new Date(today);
      startOfWeek.setDate(today.getDate() - today.getDay()); // Sunday
      startOfWeek.setHours(0,0,0,0);
      const endOfWeek = new Date(today);
      endOfWeek.setDate(today.getDate() + (6 - today.getDay())); // Saturday
      endOfWeek.setHours(23,59,59,999);

      document.querySelectorAll('.game-card[data-date]').forEach(card => {
        const gameDateStr = card.getAttribute('data-date');
        if (gameDateStr) {
          const gameDate = new Date(gameDateStr);
          if (gameDate >= startOfWeek && gameDate <= endOfWeek) {
            card.classList.add('highlight-week');
          }
        }
      });
    });
  </script>
</body>
</html>
