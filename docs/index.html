<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Plan 11B – Season 25-26</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <header class="main-header">
    <img src="images/CUP10.PNG" alt="Team Logo" class="logo" />
    <h1>Game Plan 11B – Season 25-26</h1>
  </header>
  <section id="calendar"></section>
  <script>
    Promise.all([
      fetch('game_meta.json').then(r => r.json()),
      fetch('games.json').then(r => r.json())
    ]).then(([meta, games]) => {
      function scoreClass(score) {
        if (!score) return '';
        const parts = score.split('-');
        if (parts.length !== 2) return '';
        const us = parseInt(parts[0], 10);
        const them = parseInt(parts[1], 10);
        if (isNaN(us) || isNaN(them)) return '';
        if (us > them) return 'score-win';
        if (us < them) return 'score-lose';
        return 'score-draw';
      }

      // Build a lookup for extra game details
      const gameMap = {};
      games.forEach(g => gameMap[g.id] = g);

      // Sort all games by date
      const sortedGames = meta
        .map(g => ({ ...g, dateObj: new Date(g.date) }))
        .filter(g => !isNaN(g.dateObj))
        .sort((a, b) => a.dateObj - b.dateObj);

      // Group games: Sat+Sun, others single
      const groups = [];
      let i = 0;
      while (i < sortedGames.length) {
        const day = sortedGames[i].dateObj.getDay();
        if (day === 6 && i + 1 < sortedGames.length && sortedGames[i + 1].dateObj.getDay() === 0) {
          // Saturday + Sunday
          groups.push([sortedGames[i], sortedGames[i + 1]]);
          i += 2;
        } else {
          // Single day group (weekday or lone weekend)
          groups.push([sortedGames[i]]);
          i += 1;
        }
      }

      // Render groups
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = groups.map(group => {
        const header = group.map(g =>
          g.dateObj.toLocaleDateString('en-US', { year: '2-digit', month: 'numeric', day: 'numeric' })
        ).join(' - ');
        return `
          <h2 class="month-header">${header}</h2>
          <div class="game-grid">
            ${group.map(details => {
              details = { ...details, ...gameMap[details.id] };
              return `
                <div class="game-card" data-date="${details.date}">
                  ${details.scorers && details.scorers.length ? `
                    <div class="scorers-list">${details.scorers.join(', ')}</div>
                  ` : ''}
                  <div class="game-date">${details.date || ''}</div>
                  <h2>${details.opponent ? 'vs ' + details.opponent : ''}</h2>
                  ${details.formation ? `<div class="formation">${details.formation}</div>` : ''}
                  <div>${details.competition || ''}</div>
                  <div class="game-meta">
                    <span class="score ${scoreClass(details.score || '')}">${details.score || ''}</span>
                  </div>
                  <a href="game.html?id=${details.id}" class="view-link">View Plan</a>
                </div>
              `;
            }).join('')}
          </div>
        `;
      }).join('');

      // Highlight current day
      const today = new Date();
      today.setHours(0,0,0,0);

      document.querySelectorAll('.game-card[data-date]').forEach(card => {
        const gameDateStr = card.getAttribute('data-date');
        if (gameDateStr) {
          const gameDate = new Date(gameDateStr);
          if (gameDate.toDateString() === today.toDateString()) {
            card.classList.add('highlight-week');
          }
        }
      });

      // Scroll to last group header (most recent week)
      const headers = Array.from(document.querySelectorAll('.month-header'));
      if (headers.length) {
        setTimeout(() => {
          headers[headers.length - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 300);
      }
    });
  </script>
</body>
</html>
