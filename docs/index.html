<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Plan 11B – Season 25-26</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="main-header">
    <img src="images/CUP10.PNG" alt="Team Logo" class="logo" />
    <h1>Game Plan 11B – Season 25-26</h1>
  </header>
  <section id="calendar"></section>
  <script>
    Promise.all([
      fetch('game_meta.json').then(r => r.json()),
      fetch('games.json').then(r => r.json())
    ]).then(([meta, games]) => {
      // Build a lookup for extra game details
      const gameMap = {};
      games.forEach(g => gameMap[g.id] = g);

      // Group games by month using meta
      const months = {};
      meta.forEach(game => {
        // Try to get date from meta, else from games.json
        const details = gameMap[game.id] || {};
        const date = game.date || details.date || '';
        // Parse month from date
        let month = '';
        if (date) {
          const [monthName, , year] = date.split(/[\s,]+/);
          month = `${monthName} ${year}`;
        }
        if (!months[month]) months[month] = [];
        months[month].push({ ...game, ...details, date });
      });

      // Helper to color score
      function scoreClass(score) {
        if (!score) return '';
        const parts = score.split('-');
        if (parts.length !== 2) return '';
        const us = parseInt(parts[0], 10);
        const them = parseInt(parts[1], 10);
        if (isNaN(us) || isNaN(them)) return '';
        if (us > them) return 'score-win';
        if (us < them) return 'score-lose';
        return 'score-draw';
      }

      // Render
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = Object.entries(months).map(([month, games]) => `
        <h2 class="month-header">${month}</h2>
        <div class="game-grid">
          ${games.map(game => {
            const score = game.score || '';
            return `
              <div class="game-card">
                <div class="game-date">${game.date || ''}</div>
                <h2>${game.opponent ? 'vs ' + game.opponent : ''}</h2>
                <div>${game.competition || ''}</div>
                <div class="game-meta">
                  <span class="formation">${game.formation || ''}</span>
                  <span class="score ${scoreClass(score)}">${score}</span>
                </div>
                <a href="game.html?id=${game.id}" class="view-link">View Plan</a>
              </div>
            `;
          }).join('')}
        </div>
      `).join('');
    });
  </script>
</body>
</html>
