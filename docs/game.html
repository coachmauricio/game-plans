<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Plan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <a href="index.html" class="back-link">&larr; Back to Dashboard</a>
  <section class="game-section" id="game-section">Loading...</section>

  <!-- Lightbox overlay for image pop-out -->
  <div id="lightbox-overlay">
    <span id="lightbox-close">&times;</span>
    <img id="lightbox-img" src="" alt="Large view" />
  </div>

  <script>
    async function loadGame() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      try {
        const res = await fetch("games.json");
        if (!res.ok) throw new Error("Could not load games.json");
        const games = await res.json();
        const game = games.find(g => g.id === id);

        if (!game) {
          document.getElementById("game-section").innerHTML = "<p>Game not found.</p>";
          return;
        }

        document.title = `vs ${game.opponent} ‚Äì Game Plan`;

        document.getElementById("game-section").innerHTML = `
          <h2>vs ${game.opponent} ‚Äì ${game.date}</h2>
          <div class="image-block">
            <div class="image-title lineup-header">Lineup</div>
            ${game.images.lineup ? `<img src="${game.images.lineup}" alt="Lineup" />` : ""}
          </div>
          <div class="image-block">
            <div class="image-title opponent-header">Opponent System of Play</div>
            ${game.images.opponentSOP ? `<img src="${game.images.opponentSOP}" alt="Opponent SOP" />` : ""}
          </div>
          <div class="image-block">
            <div class="image-title do-header">DO ‚Äì High Press</div>
            ${game.images.doFullPress ? `<img src="${game.images.doFullPress}" alt="High Press" />` : ""}
          </div>
          <div class="image-block">
            <div class="image-title do-header">DO ‚Äì Mid/Low Press</div>
            ${game.images.doMidLowPress ? `<img src="${game.images.doMidLowPress}" alt="Mid/Low Press" />` : ""}
          </div>
          <div class="image-block">
            <div class="image-title ao-header">AO ‚Äì Build</div>
            ${game.images.aoBuild ? `<img src="${game.images.aoBuild}" alt="Build" />` : ""}
          </div>
          <div class="section available-players-section">
            <h3>Available Players</h3>
            <ul>${game.availablePlayers.map(p => `<li>${p}</li>`).join("")}</ul>
          </div>
          <div class="section training-recap-section">
            <h3>Training Recap</h3>
            ${game.trainingRecap.map(r => `<p>${r}</p>`).join("")}
          </div>
          <div class="section team-focus-section">
            <h3>Team Focus</h3>
            <p>‚öΩ <strong>ATTACKING ORGANIZATION:</strong> ${game.gameModel.attackingOrganization}</p>
            <p>üõ°Ô∏è <strong>DEFENSIVE ORGANIZATION:</strong> ${game.gameModel.defensiveOrganization}</p>
            <p>üîÑ <strong>DEFENSIVE TRANSITION:</strong> ${game.gameModel.defensiveTransition}</p>
            <p>‚ö° <strong>ATTACKING TRANSITION:</strong> ${game.gameModel.attackingTransition}</p>
          </div>
          <div class="section video-review-section">
            <h3>Video Review</h3>
            ${
              game.videoReview && game.videoReview.length
                ? `<ul>${game.videoReview.map(v =>
                    `<li>
                      <a href="${v.link}" target="_blank" rel="noopener">VEO Link</a>
                      ${v.note ? `<span style="margin-left:8px;">‚Äì ${v.note}</span>` : ""}
                    </li>`
                  ).join("")}</ul>`
                : "<p>No video review available.</p>"
            }
          </div>
        `;
      } catch (err) {
        document.getElementById("game-section").innerHTML = "<p>Error loading game data.</p>";
      }
    }
    loadGame();

    // Lightbox effect for images (desktop & mobile)
    document.addEventListener("DOMContentLoaded", function() {
      const overlay = document.getElementById("lightbox-overlay");
      const overlayImg = document.getElementById("lightbox-img");
      const closeBtn = document.getElementById("lightbox-close");

      document.body.addEventListener("click", function(e) {
        if (e.target.tagName === "IMG" && e.target.closest(".image-block")) {
          overlayImg.src = e.target.src;
          overlay.classList.add("active");
        }
        if (e.target.id === "lightbox-close" || e.target.id === "lightbox-overlay") {
          overlay.classList.remove("active");
          overlayImg.src = "";
        }
      });

      // Mobile touch support
      overlay.addEventListener("touchstart", function(e) {
        overlay.classList.remove("active");
        overlayImg.src = "";
      });
    });
  </script>
</body>
</html>
